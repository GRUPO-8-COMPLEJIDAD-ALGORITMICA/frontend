<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Mapa de Respuesta - Lima</title>
    <link
      rel="stylesheet"
      href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css"
    />
    <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"></script>
    <style>
      body {
        margin: 0;
        padding: 0;
        font-family: Arial, sans-serif;
      }
      #map {
        width: 100%;
        height: 100vh;
      }
      .legend {
        position: fixed;
        bottom: 50px;
        left: 50px;
        width: 200px;
        background-color: white;
        border: 2px solid grey;
        padding: 10px;
        border-radius: 5px;
        z-index: 9999;
        font-size: 14px;
      }
      .legend h4 {
        margin: 0 0 10px 0;
        color: #1976d2;
      }
      .legend p {
        margin: 5px 0;
      }
      .status {
        font-size: 12px;
        color: #666;
      }
      .success {
        color: #4caf50;
      }
    </style>
  </head>
  <body>
    <div id="map"></div>
    <div class="legend">
      <h4>üè• Mapa de Respuesta</h4>
      <p>
        <span style="color: blue">üöë</span>
        <strong>Nodos de Respuesta:</strong> <span id="node-count">9</span>
      </p>
      <p class="status">Mapas generados din√°micamente</p>
      <p class="status success">‚úÖ Sistema funcionando correctamente</p>
    </div>

    <script>
      // Inicializar el mapa centrado en Lima
      const map = L.map("map").setView([-12.0464, -77.0428], 12);

      // Agregar capa base de OpenStreetMap
      L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png", {
        attribution: "¬© OpenStreetMap contributors",
      }).addTo(map);

      // Definir iconos personalizados para diferentes tipos de respuesta
      const hospitalIcon = L.icon({
        iconUrl:
          "https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-icon-blue.png",
        shadowUrl:
          "https://cdnjs.cloudflare.com/ajax/libs/leaflet/0.7.7/images/marker-shadow.png",
        iconSize: [25, 41],
        iconAnchor: [12, 41],
        popupAnchor: [1, -34],
        shadowSize: [41, 41],
      });

      const fireIcon = L.icon({
        iconUrl:
          "https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-icon-orange.png",
        shadowUrl:
          "https://cdnjs.cloudflare.com/ajax/libs/leaflet/0.7.7/images/marker-shadow.png",
        iconSize: [25, 41],
        iconAnchor: [12, 41],
        popupAnchor: [1, -34],
        shadowSize: [41, 41],
      });

      const policeIcon = L.icon({
        iconUrl:
          "https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-icon-green.png",
        shadowUrl:
          "https://cdnjs.cloudflare.com/ajax/libs/leaflet/0.7.7/images/marker-shadow.png",
        iconSize: [25, 41],
        iconAnchor: [12, 41],
        popupAnchor: [1, -34],
        shadowSize: [41, 41],
      });

      // Puntos de respuesta de Lima
      const puntosRespuesta = [
        [
          -12.0464,
          -77.0428,
          "Hospital Nacional Dos de Mayo",
          "hospital",
          hospitalIcon,
        ],
        [
          -12.062,
          -77.0365,
          "Estaci√≥n de Bomberos Central",
          "bomberos",
          fireIcon,
        ],
        [-12.0797, -77.0365, "Comisar√≠a La Victoria", "policia", policeIcon],
        [
          -12.09,
          -77.02,
          "Hospital San Juan de Lurigancho",
          "hospital",
          hospitalIcon,
        ],
        [
          -12.12,
          -77.03,
          "Posta M√©dica Villa El Salvador",
          "hospital",
          hospitalIcon,
        ],
        [-12.03, -77.06, "Hospital Callao", "hospital", hospitalIcon],
        [-12.01, -77.05, "Defensa Civil San Mart√≠n", "defensa", policeIcon],
        [-12.1, -77.01, "Cruz Roja Ate", "hospital", hospitalIcon],
        [-12.08, -77.08, "Polic√≠a Nacional Magdalena", "policia", policeIcon],
      ];

      // Agregar marcadores al mapa
      puntosRespuesta.forEach((punto, index) => {
        const [lat, lon, nombre, tipo, icon] = punto;
        L.marker([lat, lon], { icon: icon })
          .addTo(map)
          .bindPopup(
            `<b>Nodo de Respuesta ${
              index + 1
            }</b><br><strong>${nombre}</strong><br>Tipo: ${tipo}`
          )
          .on("click", function () {
            map.setView([lat, lon], 15);
          });
      });

      // Agregar c√≠rculos de cobertura
      puntosRespuesta.forEach((punto) => {
        const [lat, lon, nombre, tipo] = punto;
        const color =
          tipo === "hospital"
            ? "blue"
            : tipo === "bomberos"
            ? "orange"
            : "green";
        L.circle([lat, lon], {
          color: color,
          fillColor: color,
          fillOpacity: 0.1,
          radius: 1500, // 1.5 km de radio de cobertura
        }).addTo(map);
      });

      // Actualizar contador de nodos
      document.getElementById("node-count").textContent =
        puntosRespuesta.length;

      // Agregar evento para mostrar coordenadas al hacer clic
      map.on("click", function (e) {
        const { lat, lng } = e.latlng;
        L.popup()
          .setLatLng(e.latlng)
          .setContent(`Coordenadas: ${lat.toFixed(6)}, ${lng.toFixed(6)}`)
          .openOn(map);
      });

      console.log("Mapa de respuesta cargado exitosamente");
    </script>
  </body>
</html>
