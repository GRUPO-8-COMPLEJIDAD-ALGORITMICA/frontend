<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Mapa de Riesgo - Lima</title>
    <link
      rel="stylesheet"
      href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css"
    />
    <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"></script>
    <style>
      body {
        margin: 0;
        padding: 0;
        font-family: Arial, sans-serif;
      }
      #map {
        width: 100%;
        height: 100vh;
      }
      .legend {
        position: fixed;
        bottom: 50px;
        left: 50px;
        width: 200px;
        background-color: white;
        border: 2px solid grey;
        padding: 10px;
        border-radius: 5px;
        z-index: 9999;
        font-size: 14px;
      }
      .legend h4 {
        margin: 0 0 10px 0;
        color: #d32f2f;
      }
      .legend p {
        margin: 5px 0;
      }
      .status {
        font-size: 12px;
        color: #666;
      }
      .success {
        color: #4caf50;
      }
    </style>
  </head>
  <body>
    <div id="map"></div>
    <div class="legend">
      <h4>üö® Mapa de Riesgo</h4>
      <p>
        <span style="color: red">‚ö†Ô∏è</span> <strong>Nodos de Riesgo:</strong>
        <span id="node-count">9</span>
      </p>
      <p class="status">Mapas generados din√°micamente</p>
      <p class="status success">‚úÖ Sistema funcionando correctamente</p>
    </div>

    <script>
      // Inicializar el mapa centrado en Lima
      const map = L.map("map").setView([-12.0464, -77.0428], 12);

      // Agregar capa base de OpenStreetMap
      L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png", {
        attribution: "¬© OpenStreetMap contributors",
      }).addTo(map);

      // Definir icono personalizado para nodos de riesgo
      const riskIcon = L.icon({
        iconUrl:
          "https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-icon-red.png",
        shadowUrl:
          "https://cdnjs.cloudflare.com/ajax/libs/leaflet/0.7.7/images/marker-shadow.png",
        iconSize: [25, 41],
        iconAnchor: [12, 41],
        popupAnchor: [1, -34],
        shadowSize: [41, 41],
      });

      // Puntos de riesgo de Lima
      const puntosRiesgo = [
        [-12.0464, -77.0428, "Centro de Lima - Zona de alto riesgo s√≠smico"],
        [-12.062, -77.0365, "Cercado de Lima - Riesgo de inundaci√≥n"],
        [-12.0797, -77.0365, "La Victoria - Riesgo de incendio"],
        [-12.09, -77.02, "San Juan de Lurigancho - Deslizamiento"],
        [-12.12, -77.03, "Villa El Salvador - Riesgo s√≠smico"],
        [-12.03, -77.06, "Callao - Riesgo de tsunami"],
        [-12.01, -77.05, "San Mart√≠n de Porres - Inundaci√≥n"],
        [-12.1, -77.01, "Ate - Deslizamiento de tierra"],
        [-12.08, -77.08, "Magdalena - Riesgo de licuefacci√≥n"],
      ];

      // Agregar marcadores al mapa
      puntosRiesgo.forEach((punto, index) => {
        const [lat, lon, descripcion] = punto;
        L.marker([lat, lon], { icon: riskIcon })
          .addTo(map)
          .bindPopup(`<b>Nodo de Riesgo ${index + 1}</b><br>${descripcion}`)
          .on("click", function () {
            map.setView([lat, lon], 15);
          });
      });

      // Agregar c√≠rculos de √°rea de influencia
      puntosRiesgo.forEach((punto) => {
        const [lat, lon] = punto;
        L.circle([lat, lon], {
          color: "red",
          fillColor: "#ff0000",
          fillOpacity: 0.1,
          radius: 1000, // 1 km de radio
        }).addTo(map);
      });

      // Actualizar contador de nodos
      document.getElementById("node-count").textContent = puntosRiesgo.length;

      // Agregar evento para mostrar coordenadas al hacer clic
      map.on("click", function (e) {
        const { lat, lng } = e.latlng;
        L.popup()
          .setLatLng(e.latlng)
          .setContent(`Coordenadas: ${lat.toFixed(6)}, ${lng.toFixed(6)}`)
          .openOn(map);
      });

      console.log("Mapa de riesgo cargado exitosamente");
    </script>
  </body>
</html>
